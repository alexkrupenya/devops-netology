# Task 1
*Опишите кратко, как вы поняли: в чем основное отличие полной (аппаратной) виртуализации, паравиртуализации и виртуализации на основе ОС.*  

При полной (аппаратной) виртуализации собственно гипервизор будет заниматься выделением необходимых аппаратных вычислительных ресурсов (CPU, RAM, дисковое пространство) для создания виртуальных машин; гипервизор не требует установки никакого дополнительного ПО, кроме него самого. Именно полная виртуализация любима в корпоративной среде, поскольку позволяет легко и быстро масштабироваться: еще пара десятков серверов в стойку не вызывает проблем при такой реализации. Гипервизор в этой схеме полностью изолирует гостевые виртуальные машины от аппаратуры, при этом даже можно использовать CPU с разной архитектурой, разрядностью шины данных -- лишь бы можно было установить на это железо гипервизор. Это гипервизоры 1 типа ("bare-metal").  В качество примера:
* ESXi гипервизор: VMware ESXi (Elastic Sky X Integrated). Предназначен для дата-центров. Управляет коллекцтей VMware виртуальных машин.
* Hyper-V гипервизор: Микрософт определяет его как тип 1, хотя и устанавливается он поверх ОС Windows. Несмотря на родительскую ОС, Hyper-V получается прямой доступ к железу и работает ниже слоев ОС.
* Citrix XenServer: бывший Xen open source проект, теперь коммерческий.

Паравиртуализация предполагает предоставление для гостевых ОС программного интерфейса, который схож с аппаратным интерфейсом, но не идентичен ему. То есть ядро хостовой ОС предоставляет некую эмуляцию железа, с которым и общается гостевая ОС. Для работы гостевой ОС требуется модификация ее ядра для уменьшения деградации производительности системы, путем переноса части критически важных по времени выполнения операций с гостевой машины на машину-хост. Это гипервизоры 2 типа, не предполагающие прямой инсталляции на хост-машину, а работающие поверх уже установленной ОС.  
Примеры:  
* Тот же Xen 3 из проекта xenproject.org. 
* Oracle Virtualbox. 
* KVM. Живет в ядре, благодаря чему имеет отличную производительность. Наличие в ядре предполагается "из коробки", если ядро собрано с поддержкой KVM. Имеет собственную библиотеку и утилиты для работы с виртуальными машинами.
* Qemu. Умеет KVM, что позволяет отнести его к типу 2 гипервизоров. Если же CPU не поддерживает Intel VT или AMD-V - то с производительностью все будет очень печально, так как qemu будет работать эмулятором PC (как и известный эмулятор 86 архитектуры BOCHS).
* Parallels. Доступен на Apple MAC. Рекламируется как "запустить MS Windows на вашем Mac-е".
* Hyper-V - умеет также паравиртуализацию.
* VMWare Workstation.

Виртуализация на основе ОС - запуск изолированных экземпляров пользовательского пространства ОС. В отличие от виртуализации 1 и  2 типа, не позволяет запускать ОС, отличные ядром от исполняемой  на хостовой машине. Для упомянутых экземпляров принято название "контейнеры"; с точки зрения администратора UNIX-way операционных систем представляют собой "chroot jail на стероидах". ПО, работающее внутри контейнера, видит только предназначенные ему ресурсы, но использовать может все доступное железо. Плюсы - отсутствуют накладные расходы на несколько слоев виртуализации, как в гипервизорах 1 и 2 типов. Производительность контейнеров практически равна производительности железа, на которых они выполняются. ПО для контейнеризации:
* OpenSolaris. Умеет контейнеры Solaris Zones "из коробки". Позволяет запускать ОС GNU Linux без перекомпиляции.
* OpenVZ. Работает на Linux. Требует собственного ядра. 
* LXC. Рантайм для создания контейнеров на ОС Linux. Сейчас оброс проектами LXD для управления всем добром, и LXCFS для упрощения обмена данными между контейнерами.
* Docker. ПО для развертывания и управления прикладными приложениями в среде контейнеров. Сейчас использует собственную библиотку виртуализации. Любим за многофункциональность.
* systemd. Да, оно тоже умеет контейнеры и они даже работают. ``systemd-nspawn`` плюс ``machinectl`` выполняют необходимую работу. 

Краткий вывод: аппаратная виртуализация предполагает прямой доступ гипервизора к ресурсам вычислительной системы и полностью изолирует гостевые ОС от железа.  

# Task 2

*Выберите один из вариантов использования организации физических серверов, в зависимости от условий использования.*

*Организация серверов:*

* *физические сервера,*
* *паравиртуализация,*
* *виртуализация уровня ОС.*

*Условия использования:*

* *Высоконагруженная база данных, чувствительная к отказу.*
* *Различные web-приложения.*
* *Windows системы для использования бухгалтерским отделом.*
* *Системы, выполняющие высокопроизводительные расчеты на GPU.*

*Опишите, почему вы выбрали к каждому целевому использованию такую организацию.* 

1. Для высоконагруженной базы данных необходимо применять быстрое и отказоустойчивое решение. Для минимизации риска отказа необходимо сокращать количество слоев ПО, задействованного в рантайме БД. Таким образом, верным решением будет разместить БД на физическом сервере (серверах). Получим максимальное быстродействие и улучшим отказоустойчивость, минимизировав количество применяемого ПО.  
 
2. Для web-приложений обычно используется некий стек ПО, который стандартизирован в рамках конкретного проекта. Из чего следует, что контейнеризация отлично подойдет для выполнения веб-приложений. Для веба жесткие требования к аппаратному обеспечению обычно отсутствуют, и контейнеры позволяют легко масштабироваться при изменении нагрузки. 

3. Windows-системы для бухгалтерии предполагают инфраструктуру MS Windows, часто включая AD. Для задачи подходит использования паравиртуализации, поскольку требований к высокой производительности нет; виртуальные машины удобно клонировать и делать их архивные копии.

4. Для систем, выполняющих расчеты с высокой производительностью (для чего и применяется GPU), необходимо использовать физические серверы. Имеем минимум ПО - получаем максимум производительности.

# Task 3

*Выберите подходящую систему управления виртуализацией для предложенного сценария. Детально опишите ваш выбор.*

*Сценарии:*

*1. 100 виртуальных машин на базе Linux и Windows, общие задачи, нет особых требований. Преимущественно Windows based инфраструктура, требуется реализация программных балансировщиков нагрузки, репликации данных и автоматизированного механизма создания резервных копий.*  
*2. Требуется наиболее производительное бесплатное open source решение для виртуализации небольшой (20-30 серверов) инфраструктуры на базе Linux и Windows виртуальных машин.*  
*3. Необходимо бесплатное, максимально совместимое и производительное решение для виртуализации Windows инфраструктуры.*  
*4. Необходимо рабочее окружение для тестирования программного продукта на нескольких дистрибутивах Linux.*  

1. Поскольку среда в основном состоит из машин на MS Windows, то предпочтительнее использовать для Linux паравиртуализацию на базе Hyper-V. В качестве балансировщика нагрузки использовать Linux с простейшим вариантом на iproute2 (все зависит от задач), nginx в случае веб, либо Windows server с NLB. Для бэкпарования - средства ограничены только фантазией реализатора. Репликация данных совершенно явно зависит от типа данных, способа их хранения и методов последующей обработки, потому для каждой системы или сервиса применяются свои способы. Все зависит от персонала. Необходимо использовать те решения, которые будут наименее затратны с точки зрения ведения бизнеса. Выбирая решения, особенно внимательно нужно относиться к компетентности работников, а также их обучению и обучаемости. 

2. Я выбрал бы в качестве Opensource решения KVM. Дешево, производительно, хорошо документировано, давно известно.

3. Hyper-V Server 2019 отлично подходит тем, кто не желает платить за аппаратную виртуализацию систем. Hyper-V не имеет ограничений и полностью бесплатен. Таким образом, выбор очевиден - это Hyper-V.

4. Предположу, что тестирование программного продукта дело долгое - считаю, что проект в процессе разработки. В этом случае можно обратиться к Amazon, Yandex или другим поставщикам облачных услуг за виртуальными машинами. Если же есть возможность, то можно развернуть на месте контейнеры Docker, либо systemd. Контейнеры не зависят от вида дистрибутива, а ядро у всех дистрибутивов будет GNU Linux. Но в любом случае необходимо экономическое обоснование и расчет затрат. Возможно, что аренда ВМ у облачных поставщиков окажется выгоднее поддержания собственного ресурса.

# Task 4

*Опишите возможные проблемы и недостатки гетерогенной среды виртуализации (использования нескольких систем управления виртуализацией одновременно) и что необходимо сделать для минимизации этих рисков и проблем. Если бы у вас был выбор, то создавали бы вы гетерогенную среду или нет? Мотивируйте ваш ответ примерами.*

Начну с гетерогенной среды. В гетерогенной среде есть большой недостаток - сопрождение нескольких систем. Как показывает практика, гениев  существует немного и они нарасхват, потому для поддержки и сопровождения нескольких систем потребуется больше сотрудников, чем для поддержки гомогенной среды. Отсюда же проистекает проблема масштабируемости, поскольку придется работать с несколькими средами сразу. Бэкапирование систем будет осуществляться разными способами. Экономическая составляющая также будет играть серьезную роль в выборе среды. Гетерогенная среда предполагает бОльшие затраты в любом случае, нежели гомогенная, хотя бы даже за счет увеличения фонда заработной платы. Конечно, иногда существует производственная необходимость в гетерогенных средах. Это, например, миграция с существующего ПО на ПО другого вендора; в этом случае гетерогенная среда является осознанной необходимостью.  
Для минимизации рисков и проблем лучше применять гомогенные среды. Если же "так получилось и так работает исторически", то обязательно проводить обучение сотрудников всем применяемым инструментам; документировать техпроцессы; вести логи (журналы) учета производимых работ, чтобы потом легко отыскать проблему в случае ее возникновения (начальство любит читать журналы для поиска виноватых).  
В любом случае, для решения задачи "гетерогенная или гомогенная среда" необходимо сразу расмматривать вопрос экономической целесообразности того или иного решения. В это и упирается любая проблема, поскольку придумать можно все, что угодно, но не на все хватит средств и времени. Для себя лично как для работника некоей компании выбор очевиден - конечно, гомогенная среда.   
Приходилось в своей практике работать с целым сонмом различных систем, и это совсем не вдохновляет на производственные подвиги. Потому был выбран QEMU с KVM в качестве лечения всех проблем, и все решения работают уже много лет. В частности, отказоустойчивые кластеры для сбора тарификационных данных реализованы именно на контейнерах LXC; различные мониторинговые системы, требующие обязательной MS Windows (из-за MSSQL) - работают в Qemu, и прочее и прочее. Для серверов была выбрана CentOS. Использовалось единообразное железо, закупленное централизованно. Среда управлялась единым инструментом, созданным командой самостоятельно.




