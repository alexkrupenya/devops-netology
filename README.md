# Домашнее задание к занятию "4.1. Командная оболочка Bash: Практические навыки"

## Обязательная задача 1

Есть скрипт bash:
```bash
a=1
b=2
c=a+b
d=$a+$b
e=$(($a+$b))
```

Какие значения переменным c,d,e будут присвоены? Почему?  
*Решение:*

| Переменная  | Значение | Обоснование |
| ------------- | ------------- | ------------- |
| `a`  | `1`  | Присваивание переменной `a` без объявления типа символьного значения `1`  | 
| `b`  | `2`  | Присваивание переменной `b` без объявления типа символьного значения `2` | 
| `c`  | `a+b`  | Присваивание переменной `c` без объявления типа строкового значения `a+b` |
| `d`  | `1+2`    |  Присваивание переменной `d` без объявления типа строки, состоящей из значений переменных `a` и `b` со знаком `+` между ними   |
| `e`  | `3` | Присваивание переменной `e` без объявления типа символьного значения, являющегося результатом  арифметического сложения значений переменных `a` и `b` (действие в двойных круглых скобках)|

## Обязательная задача 2
На нашем локальном сервере упал сервис и мы написали скрипт, который постоянно проверяет его доступность, записывая дату проверок до тех пор, пока сервис не станет доступным. В скрипте допущена ошибка, из-за которой выполнение не может завершиться, при этом место на Жёстком Диске постоянно уменьшается. Что необходимо сделать, чтобы его исправить:
```bash
while ((1==1)
do
	curl https://localhost:4757
	if (($? != 0))
	then
		date >> curl.log
	fi
done
```
*Решение:*
```bash
while ((1==1))
do
    curl https://localhost:4757
    if (($? != 0))
    then
        date >> curl.log
    else
		exit
    fi
done
```
Исправлено: добавлена закрывающая скобка в ``while((1==1))``, и проверка условия на успешное выполнение ``curl https://localhost:4757`` с помощью else в цикле if. По успеху - выполняется exit.
Если рассуждать далее, то хорошо иметь счетчик попыток проверки. Со счетчиком  скрипт будет иметь вид:
```bash
unset errc # счетчик попыток
while ((1<2))
do
    curl https://localhost:4757
    if (($? != 0 && $((errc+=1)) <= 100))
    then
	echo 
        date >> curl.log
    else
		exit
    fi
done
```
Количество попыток принято равным 100, условие указано в операторе if.  
Необходимо написать скрипт, который проверяет доступность трёх IP: `192.168.0.1`, `173.194.222.113`, `87.250.250.242` по `80` порту и записывает результат в файл `log`. Проверять доступность необходимо пять раз для каждого узла.

### Ваш скрипт:
```bash
#!/bin/bash

hostset=(192.168.0.1 173.194.222.113 87.250.250.242)
echo ================================================================== >>outfile
for i in ${hostset[@]}
	do
		url=http://${i}:80/
		echo $url >>outfile
		for ii in {1..5}
		    do
			echo =========TRY N ${ii} >> outfile
			curl ${url} >>outfile 2>&1
			if (($? != 0))
				then
					echo ========${i} is not accessible >> outfile
				else
					echo ========${i} is accessible >> outfile
				fi
		done
	done

```

## Обязательная задача 3
Необходимо дописать скрипт из предыдущего задания так, чтобы он выполнялся до тех пор, пока один из узлов не окажется недоступным. Если любой из узлов недоступен - IP этого узла пишется в файл error, скрипт прерывается.

### Ваш скрипт:
```bash
#!/bin/bash

hostset=(192.168.0.1 173.194.222.113 87.250.250.242)
while (true)
do
for i in ${hostset[@]}
	do
		url=http://${i}:80/
		for ii in {1..5}
		    do
			echo =========TRY N ${ii} >> outfile
			curl ${url} >>outfile 2>&1
			if (($? != 0))
				then
					echo ========${i} is not accessible >> outfile
					exit 42
				fi
		done
	done
done
```


